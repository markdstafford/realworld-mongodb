# Migration Changelog

This document tracks all significant codebase modifications made during the H2 to MongoDB migration. Each entry includes the date, the task it relates to, the reason for the change, a diff of the modifications, and the success criteria met.

---

## 2025-06-11 - Fix `schema.sql` for H2 Compatibility

**Related Task:** Phase 0, Task 0.2 (Execute initial tests and establish baseline - Prerequisite Fix)

**Reason for Change:**

During the initial execution of `./gradlew clean test` as part of establishing the project baseline, a test failure occurred:
`RealWorldApplicationTest > contextLoads() FAILED`
  `java.lang.IllegalStateException at DefaultCacheAwareContextLoaderDelegate.java:180`
    `Caused by: org.springframework.beans.factory.BeanCreationException at AbstractBeanFactory.java:326`
      `Caused by: org.springframework.beans.factory.BeanCreationException at AbstractAutowireCapableBeanFactory.java:1788`
        `Caused by: org.springframework.jdbc.datasource.init.ScriptStatementFailedException at ScriptUtils.java:282`
          `Caused by: org.h2.jdbc.JdbcSQLSyntaxErrorException at DbException.java:514`
          `Syntax error in SQL statement "create [*]database realworld"; SQL statement: create database realworld [42001-224]`

The root cause was the `CREATE DATABASE realworld;` statement in `module/persistence/src/main/resources/schema.sql`. This command is not valid for H2 when used in this manner, as H2 typically handles database creation implicitly based on the JDBC URL (for in-memory or file-based databases). Spring Boot's schema initialization was attempting to run this script, leading to the H2 syntax error.

The fix involved removing this incompatible line from `schema.sql`.

**Code Diff (`module/persistence/src/main/resources/schema.sql`):**

```diff
--- a/module/persistence/src/main/resources/schema.sql
+++ b/module/persistence/src/main/resources/schema.sql
@@ -1,5 +1,3 @@
-create database realworld;
-
 create table article
 (
     id          integer generated by default as identity,

```

**Success Criteria:**

- After applying the fix, the `./gradlew clean test` command completed successfully.
- All 15 unit tests passed.
- A stable project baseline with a correctly functioning H2 database setup was established, allowing the migration to proceed.
---
